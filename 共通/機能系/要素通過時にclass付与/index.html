<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title></title>
  </head>
  <body>
    <style>
      .fixed-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: blue;
        color: white;
        padding: 10px 20px;
        transition: background 0.3s;
      }

      .fixed-btn.hovering {
        background: red;
      }

      .change-hover {
        height: 200px;
        background: lightgray;
        margin: 100px 0;
      }
      .footer {
        width: 100%;
        height: 100vh;
        background: pink;
        display: block;
      }
    </style>

    <!-- 複数の .change-hover -->
    <div class="change-hover">ブロック1</div>
    <div class="change-hover">ブロック2</div>
    <div class="change-hover">ブロック3</div>
    <footer class="footer">フッター</footer>
    <div class="fixed-btn">固定ボタン</div>

    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script>
      var isHidden = false; // フェード状態を管理

      function checkHoverOverlap() {
        var $btn = $('.fixed-btn');
        var windowHeight = $(window).height();
        var scrollTop = $(window).scrollTop();

        var btnTop = windowHeight - $btn.outerHeight() - 20;
        var btnY = scrollTop + btnTop;

        var isOverlapping = false;

        $('.change-hover').each(function () {
          var $el = $(this);
          var offsetTop = $el.offset().top;
          var offsetBottom = offsetTop + $el.outerHeight();

          if (btnY >= offsetTop && btnY <= offsetBottom) {
            isOverlapping = true;
            return false;
          }
        });

        if (isOverlapping) {
          $btn.addClass('hovering');
        } else {
          $btn.removeClass('hovering');
        }

        // ▼ 最後の .change-hover を通過したらボタンを非表示にする処理 ▼
        var $last = $('.change-hover').last();
        var lastBottom = $last.offset().top + $last.outerHeight();

        if (btnY > lastBottom) {
          if (!isHidden) {
            $btn.fadeOut();
            isHidden = true;
          }
        } else {
          if (isHidden) {
            $btn.fadeIn();
            isHidden = false;
          }
        }
      }

      $(window).on('scroll resize', function () {
        checkHoverOverlap();
      });

      $(function () {
        checkHoverOverlap();
      });
    </script>
  </body>
</html>
